```markdown /D:\all_of_program\GeoDsp\项目结构说明文档.md
# GeoDsp项目结构说明文档

## 1. 项目概述
GeoDsp是一个基于Spring Boot的地理数据处理系统后端服务，采用前后端分离架构，使用MyBatis-Plus进行数据库操作，支持多模块业务扩展。

## 2. 目录结构
```
GeoDsp/
├── .gitattributes        # Git属性配置
├── .gitignore            # Git忽略文件配置
├── .mvn/                 # Maven包装器目录
│   └── wrapper/          # Maven包装器
│       └── maven-wrapper.properties  # Maven包装器配置
├── HELP.md               # 项目帮助文档
├── mvnw                  # Maven包装器脚本(Linux)
├── mvnw.cmd              # Maven包装器脚本(Windows)
├── pom.xml               # Maven项目配置文件
├── src/                  # 源代码目录
│   ├── main/             # 主源码目录
│   │   ├── java/         # Java源码目录
│   │   │   └── com/      # 公司/组织域名目录
│   │   └── resources/    # 资源文件目录
│   └── test/             # 测试代码目录
│       └── java/         # 测试Java源码目录
└── target/               # 编译输出目录
├── classes/          # 编译后的类文件
├── generated-sources/ # 自动生成的源码
└── maven-status/     # Maven构建状态
```

## 3. 核心目录详解

### 3.1 src/main/java/com/geo/dsp/
项目主源码目录，采用`com.geo.dsp`包命名。

#### 3.1.1 GeoDspApplication.java
**功能**：Spring Boot应用程序入口类，负责启动整个应用。
**代码示例**：
```java
package com.geo.dsp;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class GeoDspApplication {

    public static void main(String[] args) {
        SpringApplication.run(GeoDspApplication.class, args);
    }
}
```

#### 3.1.2 common/ - 公共组件目录
存放项目通用的工具类、常量、异常处理等。

##### 3.1.2.1 constant/ - 常量定义
- **ResultCode.java**：定义统一返回结果的状态码
  ```java
  package com.geo.dsp.common.constant;

  public enum ResultCode {
      SUCCESS(200, "success"),
      FAIL(500, "fail"),
      UNAUTHORIZED(401, "未授权"),
      FORBIDDEN(403, "禁止访问"),
      NOT_FOUND(404, "资源不存在"),
      PARAM_ERROR(400, "参数错误");

      private final int code;
      private final String message;

      ResultCode(int code, String message) {
          this.code = code;
          this.message = message;
      }

      public int getCode() { return code; }
      public String getMessage() { return message; }
  }
  ```

##### 3.1.2.2 exception/ - 异常处理
- **GlobalExceptionHandler.java**：全局异常处理器
  ```java
  package com.geo.dsp.common.exception;

  import com.geo.dsp.common.result.Result;
  import org.springframework.web.bind.annotation.ExceptionHandler;
  import org.springframework.web.bind.annotation.RestControllerAdvice;

  @RestControllerAdvice
  public class GlobalExceptionHandler {

      @ExceptionHandler(Exception.class)
      public Result<String> handleException(Exception e) {
          return Result.error(500, "系统异常：" + e.getMessage());
      }
  }
  ```

##### 3.1.2.3 result/ - 统一返回结果
- **Result.java**：定义API统一返回格式
  ```java
  package com.geo.dsp.common.result;

  public class Result<T> {
      private int code;
      private String message;
      private T data;

      // 构造函数和getter/setter方法
      
      // 静态工厂方法示例
      public static <T> Result<T> success(T data) {
          Result<T> result = new Result<>();
          result.setCode(200);
          result.setMessage("success");
          result.setData(data);
          return result;
      }
  }
  ```

##### 3.1.2.4 util/ - 工具类
存放通用工具类，如字符串处理、日期处理等。

#### 3.1.3 config/ - 配置类目录
存放Spring Boot配置类。

##### 3.1.3.1 CorsConfig.java - 跨域配置
**功能**：配置CORS策略，允许前端跨域请求。
```java
package com.geo.dsp.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

@Configuration
public class CorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOriginPattern("*");
        config.addAllowedMethod("*");
        config.addAllowedHeader("*");
        config.setAllowCredentials(true);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }
}
```

##### 3.1.3.2 MyBatisPlusConfig.java - MyBatis Plus配置
**功能**：配置MyBatis Plus，如分页插件、乐观锁插件等。
```java
package com.geo.dsp.config;

import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MyBatisPlusConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor());
        return interceptor;
    }
}
```

##### 3.1.3.3 SecurityConfig.java - Spring Security配置
**功能**：配置Spring Security，包括认证、授权规则等。
```java
package com.geo.dsp.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/smart-doc/**", "/doc/**").permitAll()
                .requestMatchers("/static/**", "/public/**").permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form -> form.permitAll())
            .httpBasic(httpBasic -> httpBasic.realmName("GeoDsp API"));

        return http.build();
    }
}
```

##### 3.1.3.4 SmartDocConfig.java - SmartDoc配置
**功能**：SmartDoc文档生成工具的配置类。
```java
package com.geo.dsp.config;

import org.springframework.context.annotation.Configuration;

@Configuration
public class SmartDocConfig {
    // SmartDoc主要通过smart-doc.json配置文件工作，此类可留空或移除
}
```

#### 3.1.4 filter/ - 过滤器目录
存放自定义过滤器，如请求日志过滤器、XSS防护过滤器等。

#### 3.1.5 module/ - 业务模块目录
采用模块化设计，每个模块包含完整的业务功能。

##### 3.1.5.1 user/ - 用户模块
**功能**：处理用户相关业务，包括用户管理、权限控制等。
```
user/
├── bo/         # Business Object，业务对象
├── controller/ # 控制器层，处理HTTP请求
├── dto/        # Data Transfer Object，数据传输对象
├── entity/     # 实体类，对应数据库表
├── mapper/     # Mapper接口，数据库操作
├── service/    # 服务层，业务逻辑
│   └── impl/   # 服务实现类
└── vo/         # View Object，视图对象
```

**示例代码**：
- **实体类**：User.java
  ```java
  package com.geo.dsp.module.user.entity;

  import com.baomidou.mybatisplus.annotation.TableName;
  import com.baomidou.mybatisplus.annotation.IdType;
  import com.baomidou.mybatisplus.annotation.TableId;
  import java.time.LocalDateTime;
  import java.io.Serializable;
  import lombok.Data;

  @Data
  @TableName("sys_user")
  public class User implements Serializable {
      @TableId(value = "id", type = IdType.AUTO)
      private Long id;
      private String username;
      private String password;
      private String realName;
      private String email;
      private Integer status;
      private LocalDateTime createTime;
      private LocalDateTime updateTime;
  }
  ```

- **控制器**：UserController.java
  ```java
  package com.geo.dsp.module.user.controller;

  import com.geo.dsp.common.result.Result;
import com.geo.dsp.module.user.entity.User;
  import com.geo.dsp.module.user.service.UserService;
  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.web.bind.annotation.GetMapping;
  import org.springframework.web.bind.annotation.RequestMapping;
  import org.springframework.web.bind.annotation.RestController;

  import java.util.List;

  @RestController
  @RequestMapping("/user")
  public class UserController {

      @Autowired
      private UserService userService;

      @GetMapping("/list")
      public Result<List<User>> getUserList() {
          List<User> userList = userService.list();
          return Result.success(userList);
      }
  }
  ```

##### 3.1.5.2 data/ - 数据模块
**功能**：处理地理数据相关业务，如数据导入、导出、分析等。

##### 3.1.5.3 equipment/ - 设备模块
**功能**：处理设备管理相关业务，如设备注册、状态监控等。

##### 3.1.5.4 login/ - 登录模块
**功能**：处理用户登录、登出、令牌管理等认证相关业务。

##### 3.1.5.5 privilege/ - 权限模块
**功能**：处理权限管理相关业务，如角色分配、权限控制等。

### 3.2 src/main/resources/ - 资源文件目录

#### 3.2.1 application.properties - 应用配置文件
**功能**：配置应用程序参数，如服务器端口、数据库连接、日志级别等。
```properties
# 应用基本配置
spring.application.name=GeoDsp

# 服务器配置
server.port=8081
server.servlet.context-path=/geo

# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/geo_dsp?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# MyBatis Plus配置
mybatis-plus.mapper-locations=classpath:mapper/**/*.xml
mybatis-plus.type-aliases-package=com.geo.dsp.module.*.entity

# 日志配置
logging.level.com.geo.dsp=info
logging.level.com.geo.dsp.mapper=debug

# Spring Security配置
spring.security.user.name=admin
spring.security.user.password=123456

# SmartDoc配置
smart.doc.project-name=GeoDsp
smart.doc.package-prefix=com.geo.dsp
```

#### 3.2.2 mapper/ - MyBatis映射文件目录
**功能**：存放MyBatis的XML映射文件，定义SQL语句。
**示例**：UserMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.geo.dsp.module.user.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.geo.dsp.module.user.entity.User">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="real_name" property="realName"/>
        <result column="email" property="email"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, username, password, real_name, email, status, create_time, update_time
    </sql>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_user WHERE id = #{id}
    </select>
</mapper>
```

#### 3.2.3 smart-doc.json - SmartDoc配置文件
**功能**：配置SmartDoc文档生成工具，定义文档格式和内容。
```json
{
  "serverUrl": "http://localhost:8081/geo",
  "projectName": "GeoDsp API文档",
  "apiVersion": "1.0.0",
  "packageFilters": "com.geo.dsp.module.*.controller",
  "outPath": "target/doc",
  "allInOne": true,
  "createDebugPage": true,
  "style": "xt256",
  "showAuthor": true,
  "showReturnExample": true,
  "isStrict": false
}
```

### 3.3 target/ - 编译输出目录
**功能**：存放编译后的类文件、生成的API文档和构建结果。

## 4. 技术栈总结

| 技术/框架 | 版本 | 用途 |
|---------|-----|-----|
| Spring Boot | 3.4.0 | 应用开发框架 |
| Spring Security | 6.x | 安全认证与授权 |
| MyBatis Plus | 3.x | ORM框架，简化数据库操作 |
| MySQL | 8.x | 关系型数据库 |
| SmartDoc | 2.x | API文档生成工具 |
| Lombok | 1.18.x | 简化Java代码 |
| Maven | 3.x | 项目构建工具 |

## 5. 项目启动与运行

### 5.1 启动项目
```bash
# Windows环境
mvnw.cmd spring-boot:run

# Linux/Mac环境
./mvnw spring-boot:run
```

### 5.2 生成API文档
```bash
# 生成Markdown格式文档
mvnw.cmd smart-doc:markdown

# 生成HTML格式文档
mvnw.cmd smart-doc:html
```

## 6. 开发规范

### 6.1 命名规范
- 包名：使用小写字母，如`com.geo.dsp.module.user`
- 类名：使用大驼峰命名法，如`UserController`
- 方法名：使用小驼峰命名法，如`getUserList`
- 变量名：使用小驼峰命名法，如`userName`
- 常量名：使用全大写，单词间用下划线分隔，如`MAX_PAGE_SIZE`

### 6.2 代码结构
- 每个模块遵循MVC架构
- 控制器层只处理请求和响应
- 服务层封装业务逻辑
- Mapper层负责数据库操作
- 实体类与数据库表一一对应

## 7. 注意事项

1. **数据库配置**：首次运行前需创建`geo_dsp`数据库，并确保数据库连接参数正确
2. **端口冲突**：默认端口已改为8081，若仍冲突可在`application.properties`中修改`server.port`
3. **跨域配置**：已配置CORS策略，支持前端跨域请求
4. **权限控制**：Spring Security默认用户为`admin/123456`，生产环境需修改
5. **文档生成**：使用SmartDoc生成API文档，运行`mvnw.cmd smart-doc:markdown`即可

